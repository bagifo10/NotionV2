import{g as A,a as k,b as T,c as I,d as R,e as j,f as _}from"./data-DswU4KLL.js";async function P(d,g,N=""){if(!g)return"‚ö†Ô∏è Por favor ingresa tu API Key en la configuraci√≥n.";try{const c=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (IMPORTANTE: JSON OBLIGATORIO PARA ACCIONES):
                Si el usuario quiere crear o borrar algo, RESPONDE CON UNO O M√ÅS BLOQUES JSON.
                
                Acciones de Creaci√≥n:
                - Crear tarea: { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                - Crear evento: { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }
                - Crear proyecto: { "action": "create_project", "data": { "title": "...", "status": "Planificaci√≥n", "progress": 0, "color": "#a68a64" } }
                
                Acciones de Eliminaci√≥n (Usa los IDs del contexto):
                - Borrar tarea: { "action": "delete_task", "data": { "id": 123 } }
                - Borrar evento: { "action": "delete_event", "data": { "id": 123 } }
                - Borrar proyecto: { "action": "delete_project", "data": { "id": 123 } }
                
                CONTEXTO ACTUAL:
                ${N}
                
                REGLA DE ORO: Si generas JSON, NO a√±adas texto antes ni despu√©s. Solo el/los bloques JSON.
                `},{role:"user",content:d}],f=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",model:"llama-3.1-8b-instant",messages:c,temperature:.7})})).json();return f.error?`Error Groq: ${f.error.message}`:f.choices[0].message.content}catch{return"Error de conexi√≥n con la IA."}}function B(){const d=document.createElement("div");d.className="w-full h-full flex-col",d.style.maxWidth="900px",d.style.margin="0 auto",d.style.height="calc(100vh - 140px)";const g=document.createElement("div");g.className="flex justify-between items-center mb-4";const N=document.createElement("div"),c=document.createElement("button");c.innerText="üóëÔ∏è Limpiar Chat",c.className="text-xs hover-bg",c.style.color="var(--text-muted)",c.style.padding="4px 8px",c.style.borderRadius="var(--radius-sm)",c.style.marginRight="8px",c.onclick=()=>{confirm("¬øBorrar historial de chat?")&&(localStorage.removeItem("chat_history"),a.innerHTML="",v("¬°Hola! Soy NotionIA. ¬øC√≥mo puedo ayudarte hoy?","ai"))};const m=document.createElement("button");m.innerText="‚öôÔ∏è Configurar Key",m.className="text-xs hover-bg",m.style.color="var(--text-muted)",m.style.padding="4px 8px",m.style.borderRadius="var(--radius-sm)",m.onclick=()=>{confirm("¬øQuieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},g.appendChild(N);const f=document.createElement("div");f.appendChild(c),f.appendChild(m),g.appendChild(f);const a=document.createElement("div");a.className="flex-col gap-md",a.style.flex="1",a.style.overflowY="auto",a.style.padding="var(--spacing-md) 0";const v=(o,n,r=!0)=>{const h=document.createElement("div");h.className=`flex w-full ${n==="user"?"justify-between":""}`,h.style.justifyContent=n==="user"?"flex-end":"flex-start";const t=document.createElement("div");t.style.padding="var(--spacing-md)",t.style.borderRadius="var(--radius-lg)",t.style.maxWidth="85%",t.style.lineHeight="1.6",t.style.fontSize="0.95rem",n==="user"?(t.style.backgroundColor="var(--accent-primary)",t.style.color="var(--bg-app)",t.style.borderBottomRightRadius="2px",t.style.fontWeight="500",t.innerText=o):(t.style.backgroundColor="var(--bg-card)",t.style.color="var(--text-main)",t.style.border="1px solid var(--border-light)",t.style.borderBottomLeftRadius="2px",t.innerHTML=o.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),h.appendChild(t),a.appendChild(h),a.scrollTop=a.scrollHeight};let b=JSON.parse(localStorage.getItem("chat_history"))||[];b.length>0?(b.forEach(o=>{const n=document.createElement("div");n.className=`flex w-full ${o.role==="user"?"justify-between":""}`,n.style.justifyContent=o.role==="user"?"flex-end":"flex-start";const r=document.createElement("div");r.style.padding="var(--spacing-md)",r.style.borderRadius="var(--radius-lg)",r.style.maxWidth="85%",r.style.lineHeight="1.6",r.style.fontSize="0.95rem",o.role==="user"?(r.style.backgroundColor="var(--accent-primary)",r.style.color="var(--bg-app)",r.innerText=o.text):(r.style.backgroundColor="var(--bg-card)",r.style.color="var(--text-main)",r.style.border="1px solid var(--border-light)",r.innerHTML=o.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),n.appendChild(r),a.appendChild(n)}),a.scrollTop=a.scrollHeight):v("¬°Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. ¬øQu√© necesitas?","ai",!1);const p=document.createElement("div");p.className="flex items-center gap-sm",p.style.backgroundColor="var(--bg-card)",p.style.padding="var(--spacing-sm)",p.style.borderRadius="var(--radius-lg)",p.style.border="1px solid var(--border-light)",p.style.marginTop="var(--spacing-md)";const x=document.createElement("button");x.innerText="üìé",x.className="hover-bg",x.style.padding="8px",x.style.borderRadius="var(--radius-sm)";const s=document.createElement("input");s.type="text",s.id="chat-input",s.placeholder="Ej: Agendar reuni√≥n ma√±ana a las 10am...",s.className="w-full",s.style.background="transparent",s.style.border="none",s.style.outline="none",s.style.color="var(--text-main)",s.style.padding="8px",s.style.fontSize="1rem";const u=document.createElement("button");u.innerText="‚û§",u.className="flex items-center justify-center",u.style.width="36px",u.style.height="36px",u.style.backgroundColor="var(--accent-primary)",u.style.borderRadius="50%",u.style.color="var(--bg-app)";const O=async()=>{const o=s.value.trim();if(!o)return;v(o,"user",!1),s.value="",b.push({role:"user",text:o}),localStorage.setItem("chat_history",JSON.stringify(b));const n=document.createElement("div");n.innerText="Pensando...",n.className="text-muted text-sm",n.style.padding="10px",a.appendChild(n),a.scrollTop=a.scrollHeight;const r=localStorage.getItem("openai_api_key");if(!r){a.removeChild(n),v("‚ö†Ô∏è Falta la API Key. Recarga la p√°gina para configurarla.","ai",!1);return}const h=JSON.stringify(A()),t=await P(o,r,h);a.removeChild(n);let E=t;try{const C=[];let S=t.indexOf("{");for(;S!==-1;){let y=0,l=-1;for(let e=S;e<t.length;e++)if(t[e]==="{"?y++:t[e]==="}"&&y--,y===0){l=e;break}if(l!==-1){const e=t.substring(S,l+1);try{const i=JSON.parse(e);i.action&&C.push(i)}catch{console.log("Detected block is not valid JSON:",e)}S=t.indexOf("{",l+1)}else break}if(C.length>0){let y=0,l="";for(const e of C)if(y++,e.action==="create_task")k(e.data),l=`‚úÖ Tarea creada: **${e.data.title}**`;else if(e.action==="create_event")T(e.data),l=`‚úÖ Evento agendado: **${e.data.title}**`;else if(e.action==="create_project")I(e.data),l=`‚úÖ Proyecto creado: **${e.data.title}**`;else if(e.action==="delete_project"){const i=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);i&&R(i),l="üóëÔ∏è Proyecto eliminado correctamente."}else if(e.action==="delete_task"){const i=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);i&&j(i),l="üóëÔ∏è Tarea eliminada correctamente."}else if(e.action==="delete_event"){const i=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);i&&_(i),l="üóëÔ∏è Evento/Recordatorio eliminado correctamente."}y>1?E=`‚úÖ Se ejecutaron **${y}** acciones correctamente.`:y===1&&(E=l)}}catch(C){console.log("Error processing AI actions:",C)}v(E,"ai",!1),b.push({role:"ai",text:E}),localStorage.setItem("chat_history",JSON.stringify(b))};return u.onclick=O,s.onkeypress=o=>{o.key==="Enter"&&O()},p.appendChild(x),p.appendChild(s),p.appendChild(u),d.appendChild(g),d.appendChild(a),d.appendChild(p),d}export{B as Chatbot};
