import{g as S,a as E,b as N}from"./data-sN6guJUe.js";async function k(l,u,x=""){if(!u)return"âš ï¸ Por favor ingresa tu API Key en la configuraciÃ³n.";try{const s=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (Responde con JSON para actuar):
                Si el usuario te pide crear/borrar algo, responde SOLO con un bloque JSON asÃ­:
                
                Para crear tarea:
                { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                
                Para crear evento:
                { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }
                
                CONTEXTO ACTUAL:
                ${x}
                
                Si no es una acciÃ³n, responde normalmente en texto plano (Markdown soportado).
                `},{role:"user",content:l}],m=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",messages:s,temperature:.7})})).json();return m.error?`Error Groq: ${m.error.message}`:m.choices[0].message.content}catch{return"Error de conexiÃ³n con la IA."}}function w(){const l=document.createElement("div");l.className="w-full h-full flex-col",l.style.maxWidth="900px",l.style.margin="0 auto",l.style.height="calc(100vh - 140px)";const u=document.createElement("div");u.className="flex justify-between items-center mb-4";const x=document.createElement("div"),s=document.createElement("button");s.innerText="ðŸ—‘ï¸ Limpiar Chat",s.className="text-xs hover-bg",s.style.color="var(--text-muted)",s.style.padding="4px 8px",s.style.borderRadius="var(--radius-sm)",s.style.marginRight="8px",s.onclick=()=>{confirm("Â¿Borrar historial de chat?")&&(localStorage.removeItem("chat_history"),t.innerHTML="",h("Â¡Hola! Soy NotionIA. Â¿CÃ³mo puedo ayudarte hoy?","ai"))};const d=document.createElement("button");d.innerText="âš™ï¸ Configurar Key",d.className="text-xs hover-bg",d.style.color="var(--text-muted)",d.style.padding="4px 8px",d.style.borderRadius="var(--radius-sm)",d.onclick=()=>{confirm("Â¿Quieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},u.appendChild(x);const m=document.createElement("div");m.appendChild(s),m.appendChild(d),u.appendChild(m);const t=document.createElement("div");t.className="flex-col gap-md",t.style.flex="1",t.style.overflowY="auto",t.style.padding="var(--spacing-md) 0";const h=(r,o,a=!0)=>{const g=document.createElement("div");g.className=`flex w-full ${o==="user"?"justify-between":""}`,g.style.justifyContent=o==="user"?"flex-end":"flex-start";const e=document.createElement("div");e.style.padding="var(--spacing-md)",e.style.borderRadius="var(--radius-lg)",e.style.maxWidth="85%",e.style.lineHeight="1.6",e.style.fontSize="0.95rem",o==="user"?(e.style.backgroundColor="var(--accent-primary)",e.style.color="var(--bg-app)",e.style.borderBottomRightRadius="2px",e.style.fontWeight="500",e.innerText=r):(e.style.backgroundColor="var(--bg-card)",e.style.color="var(--text-main)",e.style.border="1px solid var(--border-light)",e.style.borderBottomLeftRadius="2px",e.innerHTML=r.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),g.appendChild(e),t.appendChild(g),t.scrollTop=t.scrollHeight};let y=JSON.parse(localStorage.getItem("chat_history"))||[];y.length>0?(y.forEach(r=>{const o=document.createElement("div");o.className=`flex w-full ${r.role==="user"?"justify-between":""}`,o.style.justifyContent=r.role==="user"?"flex-end":"flex-start";const a=document.createElement("div");a.style.padding="var(--spacing-md)",a.style.borderRadius="var(--radius-lg)",a.style.maxWidth="85%",a.style.lineHeight="1.6",a.style.fontSize="0.95rem",r.role==="user"?(a.style.backgroundColor="var(--accent-primary)",a.style.color="var(--bg-app)",a.innerText=r.text):(a.style.backgroundColor="var(--bg-card)",a.style.color="var(--text-main)",a.style.border="1px solid var(--border-light)",a.innerHTML=r.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),o.appendChild(a),t.appendChild(o)}),t.scrollTop=t.scrollHeight):h("Â¡Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. Â¿QuÃ© necesitas?","ai",!1);const i=document.createElement("div");i.className="flex items-center gap-sm",i.style.backgroundColor="var(--bg-card)",i.style.padding="var(--spacing-sm)",i.style.borderRadius="var(--radius-lg)",i.style.border="1px solid var(--border-light)",i.style.marginTop="var(--spacing-md)";const b=document.createElement("button");b.innerText="ðŸ“Ž",b.className="hover-bg",b.style.padding="8px",b.style.borderRadius="var(--radius-sm)";const n=document.createElement("input");n.type="text",n.id="chat-input",n.placeholder="Ej: Agendar reuniÃ³n maÃ±ana a las 10am...",n.className="w-full",n.style.background="transparent",n.style.border="none",n.style.outline="none",n.style.color="var(--text-main)",n.style.padding="8px",n.style.fontSize="1rem";const c=document.createElement("button");c.innerText="âž¤",c.className="flex items-center justify-center",c.style.width="36px",c.style.height="36px",c.style.backgroundColor="var(--accent-primary)",c.style.borderRadius="50%",c.style.color="var(--bg-app)";const C=async()=>{const r=n.value.trim();if(!r)return;h(r,"user",!1),n.value="",y.push({role:"user",text:r}),localStorage.setItem("chat_history",JSON.stringify(y));const o=document.createElement("div");o.innerText="Pensando...",o.className="text-muted text-sm",o.style.padding="10px",t.appendChild(o),t.scrollTop=t.scrollHeight;const a=localStorage.getItem("openai_api_key");if(!a){t.removeChild(o),h("âš ï¸ Falta la API Key. Recarga la pÃ¡gina para configurarla.","ai",!1);return}const g=JSON.stringify(S()),e=await k(r,a,g);t.removeChild(o);let v=e;try{const f=e.match(/\{[\s\S]*\}/);if(f){const p=JSON.parse(f[0]);p.action==="create_task"?(E(p.data),v=`âœ… Tarea creada: **${p.data.title}** (${p.data.priority})`):p.action==="create_event"&&(N(p.data),v=`âœ… Evento agendado: **${p.data.title}** para el ${p.data.date}`)}}catch{console.log("No valid JSON action found, using raw text")}h(v,"ai",!1),y.push({role:"ai",text:v}),localStorage.setItem("chat_history",JSON.stringify(y))};return c.onclick=C,n.onkeypress=r=>{r.key==="Enter"&&C()},i.appendChild(b),i.appendChild(n),i.appendChild(c),l.appendChild(u),l.appendChild(t),l.appendChild(i),l}export{w as Chatbot};
