import{g as T,a as O,b as k,c as A,d as R,e as j,f as I}from"./data-DswU4KLL.js";async function P(i,u,C=""){if(!u)return"âš ï¸ Por favor ingresa tu API Key en la configuraciÃ³n.";try{const l=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (IMPORTANTE: JSON OBLIGATORIO PARA ACCIONES):
                Si el usuario quiere crear/borrar, NO respondas con texto. RESPONDE CON ESTE JSON:
                
                Para crear tarea:
                { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                
                Para crear evento:
                { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }

                Para crear proyecto:
                { "action": "create_project", "data": { "title": "...", "status": "PlanificaciÃ³n", "progress": 0, "color": "#a68a64" } }
                
                CONTEXTO ACTUAL:
                ${C}
                
                REGLA DE ORO: Si generas JSON, NO aÃ±adas texto antes ni despuÃ©s. Solo el bloque JSON.
                `},{role:"user",content:i}],m=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",model:"llama-3.1-8b-instant",messages:l,temperature:.7})})).json();return m.error?`Error Groq: ${m.error.message}`:m.choices[0].message.content}catch{return"Error de conexiÃ³n con la IA."}}function w(){const i=document.createElement("div");i.className="w-full h-full flex-col",i.style.maxWidth="900px",i.style.margin="0 auto",i.style.height="calc(100vh - 140px)";const u=document.createElement("div");u.className="flex justify-between items-center mb-4";const C=document.createElement("div"),l=document.createElement("button");l.innerText="ðŸ—‘ï¸ Limpiar Chat",l.className="text-xs hover-bg",l.style.color="var(--text-muted)",l.style.padding="4px 8px",l.style.borderRadius="var(--radius-sm)",l.style.marginRight="8px",l.onclick=()=>{confirm("Â¿Borrar historial de chat?")&&(localStorage.removeItem("chat_history"),a.innerHTML="",b("Â¡Hola! Soy NotionIA. Â¿CÃ³mo puedo ayudarte hoy?","ai"))};const p=document.createElement("button");p.innerText="âš™ï¸ Configurar Key",p.className="text-xs hover-bg",p.style.color="var(--text-muted)",p.style.padding="4px 8px",p.style.borderRadius="var(--radius-sm)",p.onclick=()=>{confirm("Â¿Quieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},u.appendChild(C);const m=document.createElement("div");m.appendChild(l),m.appendChild(p),u.appendChild(m);const a=document.createElement("div");a.className="flex-col gap-md",a.style.flex="1",a.style.overflowY="auto",a.style.padding="var(--spacing-md) 0";const b=(o,n,r=!0)=>{const h=document.createElement("div");h.className=`flex w-full ${n==="user"?"justify-between":""}`,h.style.justifyContent=n==="user"?"flex-end":"flex-start";const e=document.createElement("div");e.style.padding="var(--spacing-md)",e.style.borderRadius="var(--radius-lg)",e.style.maxWidth="85%",e.style.lineHeight="1.6",e.style.fontSize="0.95rem",n==="user"?(e.style.backgroundColor="var(--accent-primary)",e.style.color="var(--bg-app)",e.style.borderBottomRightRadius="2px",e.style.fontWeight="500",e.innerText=o):(e.style.backgroundColor="var(--bg-card)",e.style.color="var(--text-main)",e.style.border="1px solid var(--border-light)",e.style.borderBottomLeftRadius="2px",e.innerHTML=o.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),h.appendChild(e),a.appendChild(h),a.scrollTop=a.scrollHeight};let g=JSON.parse(localStorage.getItem("chat_history"))||[];g.length>0?(g.forEach(o=>{const n=document.createElement("div");n.className=`flex w-full ${o.role==="user"?"justify-between":""}`,n.style.justifyContent=o.role==="user"?"flex-end":"flex-start";const r=document.createElement("div");r.style.padding="var(--spacing-md)",r.style.borderRadius="var(--radius-lg)",r.style.maxWidth="85%",r.style.lineHeight="1.6",r.style.fontSize="0.95rem",o.role==="user"?(r.style.backgroundColor="var(--accent-primary)",r.style.color="var(--bg-app)",r.innerText=o.text):(r.style.backgroundColor="var(--bg-card)",r.style.color="var(--text-main)",r.style.border="1px solid var(--border-light)",r.innerHTML=o.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),n.appendChild(r),a.appendChild(n)}),a.scrollTop=a.scrollHeight):b("Â¡Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. Â¿QuÃ© necesitas?","ai",!1);const c=document.createElement("div");c.className="flex items-center gap-sm",c.style.backgroundColor="var(--bg-card)",c.style.padding="var(--spacing-sm)",c.style.borderRadius="var(--radius-lg)",c.style.border="1px solid var(--border-light)",c.style.marginTop="var(--spacing-md)";const f=document.createElement("button");f.innerText="ðŸ“Ž",f.className="hover-bg",f.style.padding="8px",f.style.borderRadius="var(--radius-sm)";const s=document.createElement("input");s.type="text",s.id="chat-input",s.placeholder="Ej: Agendar reuniÃ³n maÃ±ana a las 10am...",s.className="w-full",s.style.background="transparent",s.style.border="none",s.style.outline="none",s.style.color="var(--text-main)",s.style.padding="8px",s.style.fontSize="1rem";const d=document.createElement("button");d.innerText="âž¤",d.className="flex items-center justify-center",d.style.width="36px",d.style.height="36px",d.style.backgroundColor="var(--accent-primary)",d.style.borderRadius="50%",d.style.color="var(--bg-app)";const S=async()=>{const o=s.value.trim();if(!o)return;b(o,"user",!1),s.value="",g.push({role:"user",text:o}),localStorage.setItem("chat_history",JSON.stringify(g));const n=document.createElement("div");n.innerText="Pensando...",n.className="text-muted text-sm",n.style.padding="10px",a.appendChild(n),a.scrollTop=a.scrollHeight;const r=localStorage.getItem("openai_api_key");if(!r){a.removeChild(n),b("âš ï¸ Falta la API Key. Recarga la pÃ¡gina para configurarla.","ai",!1);return}const h=JSON.stringify(T()),e=await P(o,r,h);a.removeChild(n);let v=e;try{const x=e.match(/\{[\s\S]*?\}/g);if(x){let E=0,y="";for(const N of x)try{const t=JSON.parse(N);E++,t.action==="create_task"?(O(t.data),y=`âœ… Tarea creada: **${t.data.title}**`):t.action==="create_event"?(k(t.data),y=`âœ… Evento agendado: **${t.data.title}**`):t.action==="create_project"?(A(t.data),y=`âœ… Proyecto creado: **${t.data.title}**`):t.action==="delete_project"?(R(t.data.id||t.data.ids?.[0]),y="ðŸ—‘ï¸ Proyecto eliminado correctamente."):t.action==="delete_task"?(j(t.data.id||t.data.ids?.[0]),y="ðŸ—‘ï¸ Tarea eliminada correctamente."):t.action==="delete_event"&&(I(t.data.id||t.data.ids?.[0]),y="ðŸ—‘ï¸ Evento/Recordatorio eliminado correctamente.")}catch{console.log("Skipping invalid JSON block")}E>1?v=`âœ… Se ejecutaron **${E}** acciones correctamente.`:E===1&&(v=y)}}catch(x){console.log("Error processing AI actions:",x)}b(v,"ai",!1),g.push({role:"ai",text:v}),localStorage.setItem("chat_history",JSON.stringify(g))};return d.onclick=S,s.onkeypress=o=>{o.key==="Enter"&&S()},c.appendChild(f),c.appendChild(s),c.appendChild(d),i.appendChild(u),i.appendChild(a),i.appendChild(c),i}export{w as Chatbot};
