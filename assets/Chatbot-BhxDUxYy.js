import{_ as A}from"./index-BMA6W2WV.js";import{getFullContext as O,addTask as T,addEvent as k,addProject as I,deleteProject as R,deleteTask as j,deleteEvent as P}from"./data-B_Xy0lOC.js";async function w(d,g,S=""){if(!g)return"‚ö†Ô∏è Por favor ingresa tu API Key en la configuraci√≥n.";try{const l=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (IMPORTANTE: JSON OBLIGATORIO PARA ACCIONES):
                Si el usuario quiere crear, borrar o editar algo, RESPONDE CON UNO O M√ÅS BLOQUES JSON.
                Puedes a√±adir texto conversacional ANTES o DESPU√âS de los bloques JSON para ser m√°s amable.
                
                Acciones de Creaci√≥n:
                - Crear tarea: { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                - Crear evento: { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }
                - Crear proyecto: { "action": "create_project", "data": { "title": "...", "status": "Planificaci√≥n", "progress": 0, "color": "#a68a64" } }
                
                Acciones de Edici√≥n (Usa los IDs del contexto):
                - Editar tarea: { "action": "edit_task", "data": { "id": 123, "title": "...", "priority": "...", "due": "...", "done": true/false } }
                - Editar evento: { "action": "edit_event", "data": { "id": 123, "title": "...", "date": "YYYY-MM-DD" } }
                
                Acciones de Eliminaci√≥n:
                - Borrar tarea: { "action": "delete_task", "data": { "id": 123 } }
                - Borrar evento: { "action": "delete_event", "data": { "id": 123 } }
                - Borrar proyecto: { "action": "delete_project", "data": { "id": 123 } }
                
                REGLAS CR√çTICAS:
                1. Si el usuario pide varias cosas (ej: "agreg√° esto y aquello"), GENERA TODOS los bloques JSON necesarios en la misma respuesta.
                2. S√© conversacional. No digas solo "Hecho". Di algo como "¬°Claro! Ya agend√© tu viaje. ¬øQuer√©s que tambi√©n te ponga un recordatorio para armar las valijas?" o similar.
                3. Usa el contexto para saber qu√© IDs editar o borrar.
                4. IMPORTANTE: Los bloques JSON deben ser v√°lidos y estar separados si son varios.
                
                CONTEXTO ACTUAL:
                ${S}
                `},{role:"user",content:d}],b=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",model:"llama-3.1-8b-instant",messages:l,temperature:.7})})).json();return b.error?`Error Groq: ${b.error.message}`:b.choices[0].message.content}catch{return"Error de conexi√≥n con la IA."}}function H(){const d=document.createElement("div");d.className="w-full h-full flex-col",d.style.maxWidth="900px",d.style.margin="0 auto",d.style.height="calc(100vh - 140px)";const g=document.createElement("div");g.className="flex justify-between items-center mb-4";const S=document.createElement("div"),l=document.createElement("button");l.innerText="üóëÔ∏è Limpiar Chat",l.className="text-xs hover-bg",l.style.color="var(--text-muted)",l.style.padding="4px 8px",l.style.borderRadius="var(--radius-sm)",l.style.marginRight="8px",l.onclick=()=>{confirm("¬øBorrar historial de chat?")&&(localStorage.removeItem("chat_history"),a.innerHTML="",x("¬°Hola! Soy NotionIA. ¬øC√≥mo puedo ayudarte hoy?","ai"))};const m=document.createElement("button");m.innerText="‚öôÔ∏è Configurar Key",m.className="text-xs hover-bg",m.style.color="var(--text-muted)",m.style.padding="4px 8px",m.style.borderRadius="var(--radius-sm)",m.onclick=()=>{confirm("¬øQuieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},g.appendChild(S);const b=document.createElement("div");b.appendChild(l),b.appendChild(m),g.appendChild(b);const a=document.createElement("div");a.className="flex-col gap-md",a.style.flex="1",a.style.overflowY="auto",a.style.padding="var(--spacing-md) 0";const x=(n,s,r=!0)=>{const h=document.createElement("div");h.className=`flex w-full ${s==="user"?"justify-between":""}`,h.style.justifyContent=s==="user"?"flex-end":"flex-start";const t=document.createElement("div");t.style.padding="var(--spacing-md)",t.style.borderRadius="var(--radius-lg)",t.style.maxWidth="85%",t.style.lineHeight="1.6",t.style.fontSize="0.95rem",s==="user"?(t.style.backgroundColor="var(--accent-primary)",t.style.color="var(--bg-app)",t.style.borderBottomRightRadius="2px",t.style.fontWeight="500",t.innerText=n):(t.style.backgroundColor="var(--bg-card)",t.style.color="var(--text-main)",t.style.border="1px solid var(--border-light)",t.style.borderBottomLeftRadius="2px",t.innerHTML=n.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),h.appendChild(t),a.appendChild(h),a.scrollTop=a.scrollHeight};let f=JSON.parse(localStorage.getItem("chat_history"))||[];f.length>0?(f.forEach(n=>{const s=document.createElement("div");s.className=`flex w-full ${n.role==="user"?"justify-between":""}`,s.style.justifyContent=n.role==="user"?"flex-end":"flex-start";const r=document.createElement("div");r.style.padding="var(--spacing-md)",r.style.borderRadius="var(--radius-lg)",r.style.maxWidth="85%",r.style.lineHeight="1.6",r.style.fontSize="0.95rem",n.role==="user"?(r.style.backgroundColor="var(--accent-primary)",r.style.color="var(--bg-app)",r.innerText=n.text):(r.style.backgroundColor="var(--bg-card)",r.style.color="var(--text-main)",r.style.border="1px solid var(--border-light)",r.innerHTML=n.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),s.appendChild(r),a.appendChild(s)}),a.scrollTop=a.scrollHeight):x("¬°Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. ¬øQu√© necesitas?","ai",!1);const c=document.createElement("div");c.className="flex items-center gap-sm",c.style.backgroundColor="var(--bg-card)",c.style.padding="var(--spacing-sm)",c.style.borderRadius="var(--radius-lg)",c.style.border="1px solid var(--border-light)",c.style.marginTop="var(--spacing-md)";const E=document.createElement("button");E.innerText="üìé",E.className="hover-bg",E.style.padding="8px",E.style.borderRadius="var(--radius-sm)";const i=document.createElement("input");i.type="text",i.id="chat-input",i.placeholder="Ej: Agendar reuni√≥n ma√±ana a las 10am...",i.className="w-full",i.style.background="transparent",i.style.border="none",i.style.outline="none",i.style.color="var(--text-main)",i.style.padding="8px",i.style.fontSize="1rem";const p=document.createElement("button");p.innerText="‚û§",p.className="flex items-center justify-center",p.style.width="36px",p.style.height="36px",p.style.backgroundColor="var(--accent-primary)",p.style.borderRadius="50%",p.style.color="var(--bg-app)";const _=async()=>{const n=i.value.trim();if(!n)return;x(n,"user",!1),i.value="",f.push({role:"user",text:n}),localStorage.setItem("chat_history",JSON.stringify(f));const s=document.createElement("div");s.innerText="Pensando...",s.className="text-muted text-sm",s.style.padding="10px",a.appendChild(s),a.scrollTop=a.scrollHeight;const r=localStorage.getItem("openai_api_key");if(!r){a.removeChild(s),x("‚ö†Ô∏è Falta la API Key. Recarga la p√°gina para configurarla.","ai",!1);return}const h=JSON.stringify(O()),t=await w(n,r,h);a.removeChild(s);let y=t;const C=[];try{let v=t.indexOf("{");for(;v!==-1;){let e=0,o=-1;for(let u=v;u<t.length;u++)if(t[u]==="{"?e++:t[u]==="}"&&e--,e===0){o=u;break}if(o!==-1){const u=t.substring(v,o+1);try{const N=JSON.parse(u);N.action&&(C.push(N),y=y.replace(u,""))}catch{console.log("Detected block is not valid JSON:",u)}v=t.indexOf("{",o+1)}else break}if(y=y.trim().replace(/\n{2,}/g,`
`),C.length>0){for(const e of C)if(e.action==="create_task")T(e.data);else if(e.action==="create_event")k(e.data);else if(e.action==="create_project")I(e.data);else if(e.action==="edit_task")A(()=>import("./data-B_Xy0lOC.js"),[]).then(o=>o.updateTask(e.data.id,e.data));else if(e.action==="edit_event")A(()=>import("./data-B_Xy0lOC.js"),[]).then(o=>o.updateEvent(e.data.id,e.data));else if(e.action==="delete_project"){const o=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);o&&R(o)}else if(e.action==="delete_task"){const o=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);o&&j(o)}else if(e.action==="delete_event"){const o=e.data.id||(Array.isArray(e.data.ids)?e.data.ids[0]:null);o&&P(o)}}}catch(v){console.log("Error processing AI actions:",v)}!y&&C.length>0&&(y=`He procesado **${C.length}** acciones correctamente.`),x(y,"ai",!1),f.push({role:"ai",text:y}),localStorage.setItem("chat_history",JSON.stringify(f))};return p.onclick=_,i.onkeypress=n=>{n.key==="Enter"&&_()},c.appendChild(E),c.appendChild(i),c.appendChild(p),d.appendChild(g),d.appendChild(a),d.appendChild(c),d}export{H as Chatbot};
