import{g as T,a as O,b as k,c as A,d as N,e as S}from"./data-D9GoZZgM.js";async function R(i,m,x=""){if(!m)return"âš ï¸ Por favor ingresa tu API Key en la configuraciÃ³n.";try{const l=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (IMPORTANTE: JSON OBLIGATORIO PARA ACCIONES):
                Si el usuario quiere crear/borrar, NO respondas con texto. RESPONDE CON ESTE JSON:
                
                Para crear tarea:
                { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                
                Para crear evento:
                { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }

                Para crear proyecto:
                { "action": "create_project", "data": { "title": "...", "status": "PlanificaciÃ³n", "progress": 0, "color": "#a68a64" } }
                
                CONTEXTO ACTUAL:
                ${x}
                
                REGLA DE ORO: Si generas JSON, NO aÃ±adas texto antes ni despuÃ©s. Solo el bloque JSON.
                `},{role:"user",content:i}],y=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",model:"llama-3.1-8b-instant",messages:l,temperature:.7})})).json();return y.error?`Error Groq: ${y.error.message}`:y.choices[0].message.content}catch{return"Error de conexiÃ³n con la IA."}}function I(){const i=document.createElement("div");i.className="w-full h-full flex-col",i.style.maxWidth="900px",i.style.margin="0 auto",i.style.height="calc(100vh - 140px)";const m=document.createElement("div");m.className="flex justify-between items-center mb-4";const x=document.createElement("div"),l=document.createElement("button");l.innerText="ðŸ—‘ï¸ Limpiar Chat",l.className="text-xs hover-bg",l.style.color="var(--text-muted)",l.style.padding="4px 8px",l.style.borderRadius="var(--radius-sm)",l.style.marginRight="8px",l.onclick=()=>{confirm("Â¿Borrar historial de chat?")&&(localStorage.removeItem("chat_history"),a.innerHTML="",b("Â¡Hola! Soy NotionIA. Â¿CÃ³mo puedo ayudarte hoy?","ai"))};const u=document.createElement("button");u.innerText="âš™ï¸ Configurar Key",u.className="text-xs hover-bg",u.style.color="var(--text-muted)",u.style.padding="4px 8px",u.style.borderRadius="var(--radius-sm)",u.onclick=()=>{confirm("Â¿Quieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},m.appendChild(x);const y=document.createElement("div");y.appendChild(l),y.appendChild(u),m.appendChild(y);const a=document.createElement("div");a.className="flex-col gap-md",a.style.flex="1",a.style.overflowY="auto",a.style.padding="var(--spacing-md) 0";const b=(o,n,r=!0)=>{const h=document.createElement("div");h.className=`flex w-full ${n==="user"?"justify-between":""}`,h.style.justifyContent=n==="user"?"flex-end":"flex-start";const t=document.createElement("div");t.style.padding="var(--spacing-md)",t.style.borderRadius="var(--radius-lg)",t.style.maxWidth="85%",t.style.lineHeight="1.6",t.style.fontSize="0.95rem",n==="user"?(t.style.backgroundColor="var(--accent-primary)",t.style.color="var(--bg-app)",t.style.borderBottomRightRadius="2px",t.style.fontWeight="500",t.innerText=o):(t.style.backgroundColor="var(--bg-card)",t.style.color="var(--text-main)",t.style.border="1px solid var(--border-light)",t.style.borderBottomLeftRadius="2px",t.innerHTML=o.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),h.appendChild(t),a.appendChild(h),a.scrollTop=a.scrollHeight};let g=JSON.parse(localStorage.getItem("chat_history"))||[];g.length>0?(g.forEach(o=>{const n=document.createElement("div");n.className=`flex w-full ${o.role==="user"?"justify-between":""}`,n.style.justifyContent=o.role==="user"?"flex-end":"flex-start";const r=document.createElement("div");r.style.padding="var(--spacing-md)",r.style.borderRadius="var(--radius-lg)",r.style.maxWidth="85%",r.style.lineHeight="1.6",r.style.fontSize="0.95rem",o.role==="user"?(r.style.backgroundColor="var(--accent-primary)",r.style.color="var(--bg-app)",r.innerText=o.text):(r.style.backgroundColor="var(--bg-card)",r.style.color="var(--text-main)",r.style.border="1px solid var(--border-light)",r.innerHTML=o.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),n.appendChild(r),a.appendChild(n)}),a.scrollTop=a.scrollHeight):b("Â¡Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. Â¿QuÃ© necesitas?","ai",!1);const d=document.createElement("div");d.className="flex items-center gap-sm",d.style.backgroundColor="var(--bg-card)",d.style.padding="var(--spacing-sm)",d.style.borderRadius="var(--radius-lg)",d.style.border="1px solid var(--border-light)",d.style.marginTop="var(--spacing-md)";const f=document.createElement("button");f.innerText="ðŸ“Ž",f.className="hover-bg",f.style.padding="8px",f.style.borderRadius="var(--radius-sm)";const s=document.createElement("input");s.type="text",s.id="chat-input",s.placeholder="Ej: Agendar reuniÃ³n maÃ±ana a las 10am...",s.className="w-full",s.style.background="transparent",s.style.border="none",s.style.outline="none",s.style.color="var(--text-main)",s.style.padding="8px",s.style.fontSize="1rem";const c=document.createElement("button");c.innerText="âž¤",c.className="flex items-center justify-center",c.style.width="36px",c.style.height="36px",c.style.backgroundColor="var(--accent-primary)",c.style.borderRadius="50%",c.style.color="var(--bg-app)";const E=async()=>{const o=s.value.trim();if(!o)return;b(o,"user",!1),s.value="",g.push({role:"user",text:o}),localStorage.setItem("chat_history",JSON.stringify(g));const n=document.createElement("div");n.innerText="Pensando...",n.className="text-muted text-sm",n.style.padding="10px",a.appendChild(n),a.scrollTop=a.scrollHeight;const r=localStorage.getItem("openai_api_key");if(!r){a.removeChild(n),b("âš ï¸ Falta la API Key. Recarga la pÃ¡gina para configurarla.","ai",!1);return}const h=JSON.stringify(T()),t=await R(o,r,h);a.removeChild(n);let p=t;try{const v=t.match(/\{[\s\S]*\}/);if(v){const e=JSON.parse(v[0]);e.action==="create_task"?(O(e.data),p=`âœ… Tarea creada: **${e.data.title}** (${e.data.priority})`):e.action==="create_event"?(k(e.data),p=`âœ… Evento agendado: **${e.data.title}** para el ${e.data.date}`):e.action==="create_project"?(A(e.data),p=`âœ… Proyecto creado: **${e.data.title}**`):e.action==="delete_project"?e.data.ids&&Array.isArray(e.data.ids)?(e.data.ids.forEach(C=>N(C)),p=`ðŸ—‘ï¸ ${e.data.ids.length} proyecto(s) eliminado(s) correctamente.`):e.data.id&&(N(e.data.id),p="ðŸ—‘ï¸ Proyecto eliminado correctamente."):e.action==="delete_task"&&(e.data.ids&&Array.isArray(e.data.ids)?(e.data.ids.forEach(C=>S(C)),p=`ðŸ—‘ï¸ ${e.data.ids.length} tarea(s) eliminada(s) correctamente.`):e.data.id&&(S(e.data.id),p="ðŸ—‘ï¸ Tarea eliminada correctamente."))}}catch{console.log("No valid JSON action found, using raw text")}b(p,"ai",!1),g.push({role:"ai",text:p}),localStorage.setItem("chat_history",JSON.stringify(g))};return c.onclick=E,s.onkeypress=o=>{o.key==="Enter"&&E()},d.appendChild(f),d.appendChild(s),d.appendChild(c),i.appendChild(m),i.appendChild(a),i.appendChild(d),i}export{I as Chatbot};
