import{g as E,a as N,b as S,c as O}from"./data-PhnJHTN7.js";async function T(i,u,f=""){if(!u)return"âš ï¸ Por favor ingresa tu API Key en la configuraciÃ³n.";try{const s=[{role:"system",content:`Eres NotionIA, un asistente inteligente integrado en una app de productividad.
                
                TUS PODERES (IMPORTANTE: JSON OBLIGATORIO PARA ACCIONES):
                Si el usuario quiere crear/borrar, NO respondas con texto. RESPONDE CON ESTE JSON:
                
                Para crear tarea:
                { "action": "create_task", "data": { "title": "...", "priority": "Alta/Media/Baja", "due": "..." } }
                
                Para crear evento:
                { "action": "create_event", "data": { "title": "...", "date": "YYYY-MM-DD" } }

                Para crear proyecto:
                { "action": "create_project", "data": { "title": "...", "status": "PlanificaciÃ³n", "progress": 0, "color": "#a68a64" } }
                
                CONTEXTO ACTUAL:
                ${f}
                
                REGLA DE ORO: Si generas JSON, NO aÃ±adas texto antes ni despuÃ©s. Solo el bloque JSON.
                `},{role:"user",content:i}],m=await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({model:"llama-3.3-70b-versatile",model:"llama-3.1-8b-instant",messages:s,temperature:.7})})).json();return m.error?`Error Groq: ${m.error.message}`:m.choices[0].message.content}catch{return"Error de conexiÃ³n con la IA."}}function R(){const i=document.createElement("div");i.className="w-full h-full flex-col",i.style.maxWidth="900px",i.style.margin="0 auto",i.style.height="calc(100vh - 140px)";const u=document.createElement("div");u.className="flex justify-between items-center mb-4";const f=document.createElement("div"),s=document.createElement("button");s.innerText="ðŸ—‘ï¸ Limpiar Chat",s.className="text-xs hover-bg",s.style.color="var(--text-muted)",s.style.padding="4px 8px",s.style.borderRadius="var(--radius-sm)",s.style.marginRight="8px",s.onclick=()=>{confirm("Â¿Borrar historial de chat?")&&(localStorage.removeItem("chat_history"),t.innerHTML="",h("Â¡Hola! Soy NotionIA. Â¿CÃ³mo puedo ayudarte hoy?","ai"))};const p=document.createElement("button");p.innerText="âš™ï¸ Configurar Key",p.className="text-xs hover-bg",p.style.color="var(--text-muted)",p.style.padding="4px 8px",p.style.borderRadius="var(--radius-sm)",p.onclick=()=>{confirm("Â¿Quieres cambiar/borrar tu API Key guardada?")&&(localStorage.removeItem("openai_api_key"),location.reload())},u.appendChild(f);const m=document.createElement("div");m.appendChild(s),m.appendChild(p),u.appendChild(m);const t=document.createElement("div");t.className="flex-col gap-md",t.style.flex="1",t.style.overflowY="auto",t.style.padding="var(--spacing-md) 0";const h=(r,o,a=!0)=>{const g=document.createElement("div");g.className=`flex w-full ${o==="user"?"justify-between":""}`,g.style.justifyContent=o==="user"?"flex-end":"flex-start";const e=document.createElement("div");e.style.padding="var(--spacing-md)",e.style.borderRadius="var(--radius-lg)",e.style.maxWidth="85%",e.style.lineHeight="1.6",e.style.fontSize="0.95rem",o==="user"?(e.style.backgroundColor="var(--accent-primary)",e.style.color="var(--bg-app)",e.style.borderBottomRightRadius="2px",e.style.fontWeight="500",e.innerText=r):(e.style.backgroundColor="var(--bg-card)",e.style.color="var(--text-main)",e.style.border="1px solid var(--border-light)",e.style.borderBottomLeftRadius="2px",e.innerHTML=r.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),g.appendChild(e),t.appendChild(g),t.scrollTop=t.scrollHeight};let y=JSON.parse(localStorage.getItem("chat_history"))||[];y.length>0?(y.forEach(r=>{const o=document.createElement("div");o.className=`flex w-full ${r.role==="user"?"justify-between":""}`,o.style.justifyContent=r.role==="user"?"flex-end":"flex-start";const a=document.createElement("div");a.style.padding="var(--spacing-md)",a.style.borderRadius="var(--radius-lg)",a.style.maxWidth="85%",a.style.lineHeight="1.6",a.style.fontSize="0.95rem",r.role==="user"?(a.style.backgroundColor="var(--accent-primary)",a.style.color="var(--bg-app)",a.innerText=r.text):(a.style.backgroundColor="var(--bg-card)",a.style.color="var(--text-main)",a.style.border="1px solid var(--border-light)",a.innerHTML=r.text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/```(.*?)```/gs,'<pre style="background:var(--bg-hover);padding:10px;border-radius:6px;overflow-x:auto;">$1</pre>')),o.appendChild(a),t.appendChild(o)}),t.scrollTop=t.scrollHeight):h("Â¡Hola! Soy NotionIA. Puedo gestionar tus tareas y calendario. Â¿QuÃ© necesitas?","ai",!1);const c=document.createElement("div");c.className="flex items-center gap-sm",c.style.backgroundColor="var(--bg-card)",c.style.padding="var(--spacing-sm)",c.style.borderRadius="var(--radius-lg)",c.style.border="1px solid var(--border-light)",c.style.marginTop="var(--spacing-md)";const b=document.createElement("button");b.innerText="ðŸ“Ž",b.className="hover-bg",b.style.padding="8px",b.style.borderRadius="var(--radius-sm)";const n=document.createElement("input");n.type="text",n.id="chat-input",n.placeholder="Ej: Agendar reuniÃ³n maÃ±ana a las 10am...",n.className="w-full",n.style.background="transparent",n.style.border="none",n.style.outline="none",n.style.color="var(--text-main)",n.style.padding="8px",n.style.fontSize="1rem";const d=document.createElement("button");d.innerText="âž¤",d.className="flex items-center justify-center",d.style.width="36px",d.style.height="36px",d.style.backgroundColor="var(--accent-primary)",d.style.borderRadius="50%",d.style.color="var(--bg-app)";const C=async()=>{const r=n.value.trim();if(!r)return;h(r,"user",!1),n.value="",y.push({role:"user",text:r}),localStorage.setItem("chat_history",JSON.stringify(y));const o=document.createElement("div");o.innerText="Pensando...",o.className="text-muted text-sm",o.style.padding="10px",t.appendChild(o),t.scrollTop=t.scrollHeight;const a=localStorage.getItem("openai_api_key");if(!a){t.removeChild(o),h("âš ï¸ Falta la API Key. Recarga la pÃ¡gina para configurarla.","ai",!1);return}const g=JSON.stringify(E()),e=await T(r,a,g);t.removeChild(o);let x=e;try{const v=e.match(/\{[\s\S]*\}/);if(v){const l=JSON.parse(v[0]);l.action==="create_task"?(N(l.data),x=`âœ… Tarea creada: **${l.data.title}** (${l.data.priority})`):l.action==="create_event"?(S(l.data),x=`âœ… Evento agendado: **${l.data.title}** para el ${l.data.date}`):l.action==="create_project"&&(O(l.data),x=`âœ… Proyecto creado: **${l.data.title}**`)}}catch{console.log("No valid JSON action found, using raw text")}h(x,"ai",!1),y.push({role:"ai",text:x}),localStorage.setItem("chat_history",JSON.stringify(y))};return d.onclick=C,n.onkeypress=r=>{r.key==="Enter"&&C()},c.appendChild(b),c.appendChild(n),c.appendChild(d),i.appendChild(u),i.appendChild(t),i.appendChild(c),i}export{R as Chatbot};
